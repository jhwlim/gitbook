---
description: 컨테이너 인프라 환경 구축을 위한 쿠버네티스/도커
---

# 5.1 컨테이너 인프라 환경에서 CI/CD

일반적으로 **CI**는 코드를 커밋하고 빌드했을 때 정상적으로 작동하는지 반복적으로 검증해 애플리케이션의 신뢰성을 높이는 작업이다. CI 과정을 마친 애플리케이션은 신뢰할 수 있는 상태가 된다.

**CD**는 CI 과정에서 생성된 신뢰할 수 있는 애플리케이션을 실제 상용 환경에 자동으로 배포하는 것을 의미한다. 애플리케이션을 사용 환경에 배포할 때 고려해야 할 사항이 여러 가지 있는데, 이를 CD에 미리 정의하면 실수를 줄이고, 실제 적용 시간도 최소화할 수 있다.

### 애플리케이션 개발 과정에서 CI와 CD

1. 개발자가 소스를 커밋하고 푸시하면 CI 단계로 들어간다.
2. CI 단계
    - 애플리케이션이 자동 빌드되고 테스트를 거쳐 배포할 수 있는 애플리케이션인지 확인한다.
    - 테스트를 통과하면 신뢰할 수 있는 애플리케이션으로 간주하고 CD 단계로 넘어간다.
3. CD 단계
    - 애플리케이션을 컨테이너 이미지로 만들어서 파드, 디플로이먼트, 스테이트풀셋 등 다양한 오브젝트 조건에 맞춰 미리 설정한 파일을 통해 배포한다.

## 1. CI/CD 도구 비교

### 팀시티 (Teamcity)

- 코틀린 기반, Kotlin DSL 이라는 스크립트 언어로 작업을 구성
- 빌드 작업을 수행하는 에이전트 3개와 빌드 작업 100개를 무료로 사용 가능

### 깃허브 액션 (Github Action)

- 깃허브에서 지원하는 워크플로우 기반의 CI/CD 도구
- 깃허브에 저장한 소스 코드를 자동 분석한 결과를 기반으로 깃허브 액션이 추천하는 방식에 따라 워크플로를 구성하거나 사용자가 직접 워크플로를 정의하는 파일을 작성한 후 깃허브 저장소에 넣어 사용할 수 있다.
- 깃허브 저장소에 소스코드를 공개할 경우 무료 사용 가능 (한달에 2000분 제한 시간)

### 뱀부 (Bamboo)

- 유료
- 사용자의 서버에 설치해 사용
- 아틀라시안에서 만든 다른 협업 도구와 연계해 사용하기 좋다.

### 젠킨스 (Jenkins)

- 오픈소스 CI/CD
- 사용자가 직접 UI에서 작업을구성하거나 적업 순서를 코드로 정의할 수 있다.
- 사용에 필요한 정보를 찾기 쉽고, 다양한 사용 환경, 언어 및 빌드 도구와 연계할 플러그인을 쉽게 찾을 수 있다.
- 특정 언어나 환경에 구애받지 않고 범용적인 목적으로 무난하게 사용 가능
- 거의 모든 환경에서 사용할 수 있도록 다양한 플러그인을 추가해 원하는 형태를 만드는 블록 방식으로 구성돼 있다.

### 기타

- 퍼블릭 클라우드 기반의 시스템일 때 : AWS CodeBuild, CodePipeline, CodeDeploy, GCP CloudBuild, Azure Pipeline
- 배포가 중요한 환경 (CD 중점) : 스핀네이커(Spinnaker), 아르고CD(Argo CD)

## 2. 젠킨스로 쿠버네티스 운영 환경 개선하기

모든 배포 환경을 컨테이너 인프라로 일원화하고, CI/CD 도구를 사용하면 

- 애플리케이션에 맞는 환경을 적용해 자동으로 배포할 수 있다.
- 통합 과정에서 만들어진 컨테이너 이미지를 기반으로 쿠버네티스가 존재하는 어떤 환경에서도 일관성이 있는 애플리케이션을 배포할 수 있다.

### 젠킨스와 쿠버네티스가 통합된 컨테이너 기반의 애플리케이션 개발 흐름

개발자가 코드를 소스 코드 저장소에 푸시하면, 쿠버네티스 내부에 설치된 젠킨스는 애플리케이션 코드를 빌드하고 레지스트리에 푸시한 후 쿠버네티스에서 사용 가능한 형태로 배포한다.

젠킨스는 작업 내용을 아이템(Item) 단위로 정의하고 조건에 따라 자동으로 작업을 수행해 효율을 높이고 실수를 줄인다.

### 컨테이너 인프라 환경에서 젠킨스를 사용하는 주된 이유

애플리케이션을 컨테이너로 만들고 배포하는 과정을 자동화하기 위해서

### 커스터마이즈와 헬름

- 동적인 변경 사항을 간편하고 빠르게 적용할 수 있도록 도와주는 기구
- 젠킨스는 컨트롤러와 에이전트 형태로 구성한 다음 배포해야 하며, 여기에 필요한 설정을 모두 넣어야 한다. 애플리케이션을 배포하기 위한 환경을 하나하나 구성하는 것은 매우 복잡하고 번거로운 일이며, 고정된 값이 아니기 때문에 매니페스트로 작성해 그대로 사용할 수 없다. 구성 환경에 따라 많은 부분을 동적으로 변경해야 한다.

