---
description: Real MySQL 8.0
---

# 4.3 MyISAM 스토리지 엔진 아키텍처

## 1. 키 캐시 (키 버퍼)

InnoDB의 버퍼 풀과 비슷한 역할

MyISAM 키 캐시는 인덱스만을 대상으로 작동하며, 또한 인덱스의 디스크 쓰기 작업에 대해서만 부분적으로 버퍼링 역할을 한다.

### 키 캐시가 얼마나 효율적으로 작동하는지 계산하기

```
키 캐시 히트율 = 100 - (Key_reads / Key_read_request * 100)
```

- `Key_reads` : 인덱스를 디스크에서 읽어 들인 횟수
- `Key_read_requests` : 키 캐시로부터 인덱스를 읽은 횟수

```sql
# 상태값 확인하기
SHOW GLOBAL STATUS LIKE 'Key%';
```

{% hint style="success" %}

일반적으로 키 캐시를 이용한 쿼리의 비율(히트율)을 99% 이상으로 유지하라고 권장한다.

히트율이 99% 미만이라면 키 캐시를 조금 더 크게 설정하는 것이 좋다.

{% endhint %}

{% hint style="warning" %}

기본 키 캐시 이외의 명명된 키 캐시 영역은 아무런 설정을 하지 않으면 메모리 할당만 해두고 사용하지 않게 된다.

즉, 기본이 아닌 명명된 추가 키 캐시는 어떤 인덱스를 캐시할지 MySQL(MyISAM 스토리지 엔진)에 알려줘야 한다.

```sql
# board 테이블의 인덱스가 캐시되도록 설정하기 (키 캐시 : kbuf_board)
CACHE INDEX db1.board IN kbuf_board
```

{% endhint %}

## 2. 운영체제의 캐시 및 버퍼

MyISAM 테이블의 인덱스는 키 캐시를 이용해 디스크를 검색하지 않고도 충분히 빠르게 검색할 수 있다.

하지만 MyISAM 테이블의 데이터에 대해서는 디스크로부터의 I/O를 해결해 줄 만한 어떠한 캐시나 버퍼링 기능도 MyISAM 테이블의 데이터에 대해서는 디스크로부터의 I/O를 해결해 줄 만한 어떠한 캐시나 버퍼링 기능도 MyISAM 스토리지 엔진은 가지고 있지 않다. 그래서 MyISAM 테이블의 데이터 읽기나 쓰기 작업은 항상 운영체제의 디스크 읽기 또는 쓰기 작업으로 요청될 수밖에 없다.

운영체제의 캐시 기능은 InnoDB 처럼 데이터의 특성을 알고 전문적으로 캐시나 버퍼링을 하지는 못하지만, 그래도 여전히 없는 것보다 낫다. 운영체제가 사용할 수 있는 캐시 공간을 위해 충분한 메모리를 비워두는 것이 좋다.

{% hint style="success" %}

MyISAM이 주로 사용되는 MySQL에서 일반적으로 키 캐시는 최대 물리 메모리의 40% 이상을 넘지 않게 설정하고, 나머지 메모리 공간은 운영체제가 자체적인 파일 시스템을 위한 캐시 공간을 마련할 수 있게 해주는 것이 좋다.

{% endhint %}

## 3. 데이터 파일과 프라이머리 키(인덱스) 구조

MyISAM 테이블은 프라이머리 키에 의한 클러스터링 없이 데이터 파일이 힙(Heap) 공간처럼 활용된다.

즉, MyISAM 테이블에 레코드는 프라이머리 키 값과 무관하게 INSERT 되는 순서대로 데이터 파일에 저장된다. 그리고 MyISAM 테이블에 저장되는 레코드는 모두 ROWID 라는 물리적인 주소값을 가진다.

이때, ROWID는 가변 길이와 고정 길이의 두 가지 방법으로 저장될 수 있다.
