---
description: 이펙티브 코틀린 정리하기
---

# API 안정성을 확인하라

안정적이고 최대한 표준적인 API를 선호하는 이유

- 라이브러리의 작은 변경은 이를 활용하는 다른 코드들의 많은 부분을 변경하게 만들 수 있다. 그래서 라이브러리가 변경되어도 이전 라이브러리를 유지하는 경우가 많다. 하지만 그럴수록 점점 업데이트가 어려워지고, 버그와 취약성 등이 발생할 수 있다.
- 사용자가 새로운 API를 배워야 한다. 새로 배우지 않으면, 오래된 지식 때문에 보안 문제가 발생할 수 있다. 따라서 처음부터 안정적인 모듈부터 공부해두는 것이 좋다.

하지만 좋은 API를 한번에 설계할 수는 없다. 따라서 API 제작자는 이를 계속해서 개선하기 위해서 변경을 원한다.

## 시멘틱 버저닝

일반적으로 버전을 활용해서 라이브러리와 모듈의 안정성을 나타낸다. 일반적으로는 **시멘틱 버저닝(Semantic Versioning, SemVer)** 을 사용한다.

- MAJOR 버전 : 호환되지 않는 수준의 API 변경
- MINOR 버전 : 이전 변경과 호환되는 기능 추가
- PATCH 버전 : 간단한 버그 수정

버전은 MAJOR`.`MINOR`.`PATCH 형태로 붙인다. MAJOR를 증가시킬 때는 MINOR와 PATCH를 0으로 돌린다. MINOR를 증가시킬 때는 PATCH를 0으로 돌린다.

메이저 버전이 0인 경우(0.y.z)는 초기 개발 전용 버전을 의미한다. 따라서 언제든지 변경될 수 있으며, 안정적이지 않다는 의미이다.

## API에 새로운 요소 추가하기

안정적인 API에 새로운 요소를 추가할 때, **아직 해당 요소가 안정적이지 않다면,** 먼저 다른 브랜치에 해당 요소를 두는 것이 좋다. 일부 사용자가 이를 사용하도록 허용하려면, **일단 `Experimental` 메타 어노테이션을 사용해서 사용자들에게 아직 해당 요소가 안정적이지 않다는 것을 알려 주는 것이 좋다.**

이러한 요소는 언제든지 변경될 수 있다. **요소를 오랜시간 동안 실험적 기능으로 유지하는 것을 두려워하지 말자.** 채택 속도는 느려지지만, 더 오래 동안 좋은 API를 설계하는 데 도움이 된다.

## API 수정하기

**안정적인 API의 일부를 변경해야 한다면, 전환하는데 시간을 두고 `Deprecated` 어노테이션을 활용해서 사용자에게 미리 알려줘야 한다.**

```kotlin
@Deprecated("Use suspending getUsers instead")
fun getUsers(callback: (List<User>) -> Unit) { ... }
```

**또한 직접적인 대안이 있다면, IDE가 자동 전환할 수 있도록 `ReplaceWith`를 붙여주는 것도 좋다.**

```kotlin
@Deprecated("Use suspending getUsers instead", ReplaceWith("getUsers()"))
fun getUsers(callback: (List<User>) -> Unit) { ... }
```

**`Deprecated`와 `ReplaceWith`를 사용했다면, 사용자가 이러한 변경에 적응할 시간을 제공해야 한다.** 적용하는 데에 시간이 꽤 걸린다. (널리 사용되는 API는 적응 시간을 몇 년으로 잡기도 한다.) 이러한 시간이 지난 뒤에는 주요 배포판(major release)에서 이 요소를 제거하면 된다.

## 정리

안정적인 API를 사용하는 것이 좋다. 다만 안정적이라고 생각했던 API에 예상하지 못한 변경이 일어났다면 수많은 사람들에게 고통을 줄 수 있다. 따라서 모듈과 라이브러리를 만드는 사람과 이를 사용하는 사람들 사이에 커뮤니케이션이 중요하다. 

커뮤니케이션은 버전 이름, 문서, 어노테이션 등을 통해 할 수 있다. 또한 안정적인 API에 변경을 가할 때는 사용자가 적응할 충분한 시간을 줘야 한다.